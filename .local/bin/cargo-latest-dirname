#!/usr/bin/env bash

set -e

([[ $# == 1 ]] && [[ -v CARGO_TARGET_DIR ]]) || exit 1

SEARCH_PATH="${CARGO_TARGET_DIR}/release/build"
SEARCH_GLOB="**/${1}-*/*"

if [[ "$(command -v fd)" ]]; then
	fd \
		-tf \
		-p \
		-g "${SEARCH_GLOB}" \
		-e timestamp \
		"${SEARCH_PATH}" \
		-X ls -tr {} \
		| tail -1 \
		| xargs -r dirname
else
	find "${SEARCH_PATH}" \
		-type f \
		-path "${SEARCH_GLOB}.timestamp" \
		-exec ls -tr {} + \
		| tail -1 \
		| xargs -r dirname
fi

